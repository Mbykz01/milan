{% extends 'core/base.html' %}

{% block title %}Refer & Earn - StockLearn{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl text-white p-8 mb-8 text-center relative overflow-hidden">
        <div class="relative z-10">
            <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-gift text-3xl"></i>
            </div>
            <h1 class="text-4xl font-bold mb-4">Refer Friends & Earn Credits</h1>
            <p class="text-green-100 text-xl max-w-2xl mx-auto">
                Invite your friends to join StockLearn and earn credits towards courses and premium subscriptions!
            </p>
        </div>
        <!-- Background decorations -->
        <div class="absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-10 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white bg-opacity-10 rounded-full translate-y-12 -translate-x-12"></div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Referral Stats -->
        <div class="bg-white rounded-2xl shadow-lg p-6 lg:col-span-2">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center space-x-2">
                <i class="fas fa-chart-bar text-blue-500"></i>
                <span>Your Referral Performance</span>
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="text-center p-4 bg-blue-50 rounded-xl">
                    <div class="text-2xl font-bold text-blue-600 mb-1">${{ available_credits }}</div>
                    <div class="text-sm text-gray-600">Available Credits</div>
                    <div class="mt-2 text-xs text-blue-500">
                        <i class="fas fa-wallet"></i>
                        Ready to use
                    </div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-xl">
                    <div class="text-2xl font-bold text-green-600 mb-1">{{ referral_count }}</div>
                    <div class="text-sm text-gray-600">Successful Referrals</div>
                    <div class="mt-2 text-xs text-green-500">
                        <i class="fas fa-users"></i>
                        Friends joined
                    </div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-xl">
                    <div class="text-2xl font-bold text-purple-600 mb-1">${{ total_earned }}</div>
                    <div class="text-sm text-gray-600">Total Earned</div>
                    <div class="mt-2 text-xs text-purple-500">
                        <i class="fas fa-coins"></i>
                        All time
                    </div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-xl">
                    <div class="text-lg font-bold text-orange-600 mb-1 font-mono">{{ user.referral_code }}</div>
                    <div class="text-sm text-gray-600">Your Code</div>
                    <div class="mt-2 text-xs text-orange-500">
                        <i class="fas fa-tag"></i>
                        Unique code
                    </div>
                </div>
            </div>

            <!-- Progress to next reward -->
            <div class="mt-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-semibold text-yellow-800">Next Reward Tier</span>
                    <span class="text-sm font-bold text-yellow-600">
                        {{ referral_count }} / 5 referrals
                    </span>
                </div>
                <div class="w-full bg-yellow-200 rounded-full h-2.5">
                    <div class="bg-yellow-500 h-2.5 rounded-full transition-all duration-500" 
                         style="width: '{{ referral_count|divisibleby:5|yesno:'100,20' }}%'">
                    </div>
                </div>
                <p class="text-xs text-yellow-700 mt-2">
                    {% if referral_count >= 5 %}
                    ðŸŽ‰ You've unlocked premium rewards! Keep referring to earn more.
                    {% else %}
                    Refer {{ remaining_referrals }} more friends to unlock exclusive rewards!
                    {% endif %}

                </p>
            </div>
        </div>

        <!-- How It Works -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center space-x-2">
                <i class="fas fa-info-circle text-green-500"></i>
                <span>How It Works</span>
            </h2>
            <div class="space-y-6">
                <div class="flex items-start space-x-4">
                    <div class="bg-blue-100 text-blue-600 rounded-xl w-12 h-12 flex items-center justify-center font-bold text-lg flex-shrink-0">
                        1
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-1">Share Your Link</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Copy your unique referral link or share directly on social media
                        </p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="bg-green-100 text-green-600 rounded-xl w-12 h-12 flex items-center justify-center font-bold text-lg flex-shrink-0">
                        2
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-1">Friends Sign Up</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Your friends sign up using your referral link or code
                        </p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="bg-purple-100 text-purple-600 rounded-xl w-12 h-12 flex items-center justify-center font-bold text-lg flex-shrink-0">
                        3
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-1">Earn Rewards</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Get <span class="font-bold text-green-600">$50 credits</span> for each successful referral
                        </p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="bg-orange-100 text-orange-600 rounded-xl w-12 h-12 flex items-center justify-center font-bold text-lg flex-shrink-0">
                        4
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-1">Friends Get Bonus</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Your friend also gets <span class="font-bold text-blue-600">$25 credits</span> when they sign up
                        </p>
                    </div>
                </div>
            </div>

            <!-- Quick Tips -->
            <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <h4 class="font-semibold text-gray-800 mb-2 flex items-center space-x-2">
                    <i class="fas fa-lightbulb text-yellow-500"></i>
                    <span>Pro Tip</span>
                </h4>
                <p class="text-sm text-gray-600">
                    Share your link in investment communities, stock trading groups, or with friends interested in learning about the stock market for best results!
                </p>
            </div>
        </div>
    </div>

    <!-- Referral Link Section -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center space-x-2">
            <i class="fas fa-link text-blue-500"></i>
            <span>Your Referral Link</span>
        </h2>
        
        <div class="space-y-4">
            <!-- Link Input -->
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1 relative">
                    <input type="text" 
                           value="{{ referral_url }}" 
                           readonly 
                           id="referralLink"
                           class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 bg-gray-50 font-mono text-sm pr-24 transition duration-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                    <button onclick="copyReferralLink()" 
                            id="copyButton"
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 flex items-center space-x-2">
                        <i class="fas fa-copy"></i>
                        <span>Copy</span>
                    </button>
                </div>
            </div>

            <p class="text-sm text-gray-600 flex items-center space-x-2">
                <i class="fas fa-info-circle text-blue-500"></i>
                <span>Share this link with your friends. When they sign up, you'll get <span class="font-semibold text-green-600">$50</span> and they'll get <span class="font-semibold text-blue-600">$25</span> in credits!</span>
            </p>

            <!-- Alternative: Referral Code -->
            <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-2">Prefer using a code?</h3>
                <div class="flex items-center space-x-4">
                    <code class="bg-white border border-gray-300 px-4 py-2 rounded-lg font-mono text-lg font-bold text-gray-800">
                        {{ user.referral_code }}
                    </code>
                    <button onclick="copyReferralCode()" 
                            class="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition duration-200 flex items-center space-x-2">
                        <i class="fas fa-copy"></i>
                        <span>Copy Code</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Social Sharing Buttons -->
        <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Share Instantly</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="shareOnWhatsApp()" 
                        class="bg-green-500 text-white p-3 rounded-xl font-semibold hover:bg-green-600 transition duration-200 flex items-center justify-center space-x-2 group">
                    <i class="fab fa-whatsapp text-xl group-hover:scale-110 transition-transform"></i>
                    <span>WhatsApp</span>
                </button>
                <button onclick="shareOnTwitter()" 
                        class="bg-blue-400 text-white p-3 rounded-xl font-semibold hover:bg-blue-500 transition duration-200 flex items-center justify-center space-x-2 group">
                    <i class="fab fa-twitter text-xl group-hover:scale-110 transition-transform"></i>
                    <span>Twitter</span>
                </button>
                <button onclick="shareOnFacebook()" 
                        class="bg-blue-600 text-white p-3 rounded-xl font-semibold hover:bg-blue-700 transition duration-200 flex items-center justify-center space-x-2 group">
                    <i class="fab fa-facebook text-xl group-hover:scale-110 transition-transform"></i>
                    <span>Facebook</span>
                </button>
                <button onclick="shareOnLinkedIn()" 
                        class="bg-blue-800 text-white p-3 rounded-xl font-semibold hover:bg-blue-900 transition duration-200 flex items-center justify-center space-x-2 group">
                    <i class="fab fa-linkedin text-xl group-hover:scale-110 transition-transform"></i>
                    <span>LinkedIn</span>
                </button>
            </div>

            <!-- Email Sharing -->
            <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                <h4 class="font-semibold text-blue-800 mb-2">Share via Email</h4>
                <p class="text-sm text-blue-700 mb-3">
                    Send personalized invitations to friends via email
                </p>
                <button onclick="shareViaEmail()" 
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 flex items-center space-x-2">
                    <i class="fas fa-envelope"></i>
                    <span>Compose Email</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Referral History -->
    <div class="bg-white rounded-2xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center space-x-2">
                <i class="fas fa-history text-purple-500"></i>
                <span>Referral History</span>
            </h2>
            <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-semibold">
                {{ user_referrals.count }} referrals
            </span>
        </div>
        
        {% if user_referrals %}
        <div class="space-y-4">
            {% for referral in user_referrals %}
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:border-green-300 hover:bg-green-50 transition duration-200">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-800">{{ referral.referred_user.username }}</p>
                        <p class="text-sm text-gray-600">{{ referral.referred_user.email }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="font-bold text-green-600 text-lg">+${{ referral.credit_amount }}</p>
                    <p class="text-sm text-gray-500">{{ referral.created_at|date:"M d, Y" }}</p>
                    <p class="text-xs text-gray-400">{{ referral.created_at|timesince }} ago</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="text-center py-12">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-users text-3xl text-gray-400"></i>
            </div>
            <h3 class="text-2xl font-semibold text-gray-700 mb-2">No Referrals Yet</h3>
            <p class="text-gray-600 mb-6 max-w-md mx-auto">
                Start sharing your referral link to earn credits! Your friends will thank you for introducing them to StockLearn.
            </p>
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 max-w-md mx-auto">
                <p class="text-yellow-800 text-sm flex items-center space-x-2">
                    <i class="fas fa-lightbulb text-yellow-500"></i>
                    <span><strong>Tip:</strong> Share in investment forums, trading groups, or with colleagues interested in stocks</span>
                </p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- FAQ Section -->
    <div class="mt-8 bg-gray-50 rounded-2xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Frequently Asked Questions</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl p-4 border border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-2">How do I use my credits?</h3>
                <p class="text-gray-600 text-sm">Credits are automatically applied when purchasing courses or upgrading your subscription. They never expire!</p>
            </div>
            <div class="bg-white rounded-xl p-4 border border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-2">When do I receive my credits?</h3>
                <p class="text-gray-600 text-sm">Credits are added instantly when your friend completes their signup and verification.</p>
            </div>
            <div class="bg-white rounded-xl p-4 border border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-2">Is there a limit to referrals?</h3>
                <p class="text-gray-600 text-sm">No limit! Refer as many friends as you want and keep earning credits for each one.</p>
            </div>
            <div class="bg-white rounded-xl p-4 border border-gray-200">
                <h3 class="font-semibold text-gray-800 mb-2">Can I combine credits with other offers?</h3>
                <p class="text-gray-600 text-sm">Yes! Credits can be combined with most promotions and discount offers.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyReferralLink() {
    const referralInput = document.getElementById('referralLink');
    const copyButton = document.getElementById('copyButton');
    
    // Select and copy
    referralInput.select();
    referralInput.setSelectionRange(0, 99999); // For mobile devices
    
    navigator.clipboard.writeText(referralInput.value).then(() => {
        // Success state
        copyButton.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
        copyButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        copyButton.classList.add('bg-green-600', 'hover:bg-green-700');
        
        // Show temporary notification
        showNotification('Referral link copied to clipboard!', 'success');
        
        // Reset button after 2 seconds
        setTimeout(() => {
            copyButton.innerHTML = '<i class="fas fa-copy"></i><span>Copy</span>';
            copyButton.classList.remove('bg-green-600', 'hover:bg-green-700');
            copyButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
        }, 2000);
    }).catch(err => {
        showNotification('Failed to copy link', 'error');
        console.error('Failed to copy: ', err);
    });
}

function copyReferralCode() {
    const code = '{{ user.referral_code }}';
    navigator.clipboard.writeText(code).then(() => {
        showNotification('Referral code copied to clipboard!', 'success');
    }).catch(err => {
        showNotification('Failed to copy code', 'error');
    });
}

function shareOnWhatsApp() {
    const text = `Join me on StockLearn - the ultimate platform for stock market education! ðŸš€ Use my referral link to get $25 in free credits: {{ referral_url }}`;
    const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareOnTwitter() {
    const text = `Just joined StockLearn - amazing platform for stock market learning! ðŸ’¹ Get $25 free credits using my referral link: {{ referral_url }}`;
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareOnFacebook() {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('{{ referral_url }}')}&quote=Join%20StockLearn%20-%20Amazing%20stock%20market%20education%20platform!`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareOnLinkedIn() {
    const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent('{{ referral_url }}')}`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareViaEmail() {
    const subject = 'Join StockLearn - Get $25 Free Credits!';
    const body = `Hi there!

I've been using StockLearn for my stock market education and thought you might find it useful too!

It's an amazing platform with courses, stock recommendations, and market news.

Use my referral link to sign up and you'll get $25 in free credits: {{ referral_url }}

We'll both earn credits when you join. Looking forward to learning together!

Best regards,
{{ user.username }}`;
    
    const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = mailtoLink;
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white font-semibold transform translate-x-full transition-transform duration-300 ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
    }`;
    notification.innerHTML = `
        <div class="flex items-center space-x-2">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Add loading animations
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.bg-white.rounded-2xl');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>

<style>
/* Custom animations */
.transition-transform {
    transition: transform 0.3s ease;
}

.group:hover .group-hover\:scale-110 {
    transform: scale(1.1);
}

/* Smooth transitions for all elements */
* {
    transition: all 0.2s ease;
}
</style>
{% endblock %} 