{% extends 'core/base.html' %}

{% block title %}Dashboard - StockLearn{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Welcome Header -->
    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl text-white p-8 mb-8 relative overflow-hidden">
        <div class="relative z-10">
            <div class="flex items-center space-x-4 mb-4">
                {% if user.profile_picture %}
                <img src="{{ user.profile_picture_url }}" alt="{{ user.username }}" class="w-16 h-16 rounded-full border-4 border-white border-opacity-20 object-cover">
                {% else %}
                <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center border-4 border-white border-opacity-20">
                    <span class="text-2xl font-bold">{{ user.username|first|upper }}</span>
                </div>
                {% endif %}
                <div>
                    <h1 class="text-3xl font-bold mb-1">Welcome back, {{ user.username }}! ðŸ‘‹</h1>
                    <p class="text-blue-100 text-lg">Continue your learning journey and stay updated with market insights.</p>
                </div>
            </div>
            
            {% if user.subscription_tier == 'free' %}
            <div class="mt-4 bg-yellow-500 bg-opacity-90 text-white p-4 rounded-lg inline-block backdrop-blur-sm">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-crown"></i>
                    <p class="font-semibold">Upgrade to Premium for full access to all courses and recommendations!</p>
                </div>
            </div>
            {% else %}
            <div class="mt-4 bg-green-500 bg-opacity-90 text-white p-4 rounded-lg inline-block backdrop-blur-sm">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-crown"></i>
                    <p class="font-semibold">You're enjoying Premium benefits! ðŸŽ‰</p>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Background Pattern -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-white bg-opacity-10 rounded-full -translate-y-32 translate-x-32"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white bg-opacity-10 rounded-full translate-y-24 -translate-x-24"></div>
    </div>

    <!-- Quick Stats Bar -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6 text-center">
            <div class="text-2xl font-bold text-blue-600 mb-1">{{ in_progress_courses|length|add:completed_courses|length }}</div>
            <div class="text-sm text-gray-600">Courses Enrolled</div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 text-center">
            <div class="text-2xl font-bold text-green-600 mb-1">{{ completed_courses|length }}</div>
            <div class="text-sm text-gray-600">Courses Completed</div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 text-center">
            <div class="text-2xl font-bold text-purple-600 mb-1">${{ user.referral_credits }}</div>
            <div class="text-sm text-gray-600">Available Credits</div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 text-center">
            <div class="text-2xl font-bold {% if user.subscription_tier == 'premium' %}text-yellow-600{% else %}text-gray-600{% endif %} mb-1">
                {{ user.subscription_tier|title }}
            </div>
            <div class="text-sm text-gray-600">Subscription</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
            
            <!-- Continue Learning -->
            <section class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Continue Learning</h2>
                    <a href="{% url 'core:course_list' %}" class="text-blue-600 hover:text-blue-700 font-semibold text-sm flex items-center space-x-1">
                        <span>Browse All Courses</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>
                
                {% if in_progress_courses %}
                <div class="space-y-4">
                    {% for enrollment in in_progress_courses %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-all duration-200 hover:shadow-md">
                        <div class="flex items-start space-x-4">
                            <!-- Course Thumbnail -->
                            {% if enrollment.course.thumbnail_url %}
                            <img src="{{ enrollment.course.thumbnail_url }}" alt="{{ enrollment.course.title }}" 
                                 class="w-16 h-16 rounded-lg object-cover flex-shrink-0">
                            {% else %}
                            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            {% endif %}
                            
                            <div class="flex-1">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h3 class="font-semibold text-lg text-gray-800">{{ enrollment.course.title }}</h3>
                                        <p class="text-gray-600 text-sm">
                                            {% if enrollment.course.instructor %}
                                                {{ enrollment.course.instructor }}
                                            {% else %}
                                                StockLearn Instructor
                                            {% endif %}
                                        </p>
                                    </div>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                                        {{ enrollment.progress|floatformat:0 }}% Complete
                                    </span>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                         style="width: '{{ enrollment.progress|default:0 }}%'"></div>
                                </div>
                                
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span class="flex items-center">
                                            <i class="fas fa-book mr-1"></i>
                                            {{ enrollment.course.lessons.count }} lessons
                                        </span>
                                        {% if enrollment.course.duration_hours %}
                                        <span class="flex items-center">
                                            <i class="fas fa-clock mr-1"></i>
                                            {{ enrollment.course.duration_hours }}h
                                        </span>
                                        {% endif %}
                                    </div>
                                    <a href="{% url 'core:course_detail' enrollment.course.id %}" 
                                       class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition duration-200 flex items-center space-x-1">
                                        <span>Continue</span>
                                        <i class="fas fa-arrow-right text-xs"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- Empty State -->
                <div class="text-center py-12">
                    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-book-open text-3xl text-gray-400"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Start Your Learning Journey</h3>
                    <p class="text-gray-500 mb-6 max-w-md mx-auto">
                        You haven't enrolled in any courses yet. Explore our catalog and start learning today!
                    </p>
                    <a href="{% url 'core:course_list' %}" 
                       class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 inline-flex items-center space-x-2">
                        <i class="fas fa-search"></i>
                        <span>Browse Courses</span>
                    </a>
                </div>
                {% endif %}
            </section>

            <!-- Stock Recommendations -->
            <section class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Weekly Stock Recommendations</h2>
                    <a href="{% url 'core:stock_recommendations' %}" class="text-blue-600 hover:text-blue-700 font-semibold text-sm flex items-center space-x-1">
                        <span>View All</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>
                
                {% if recommendations %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for rec in recommendations %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-semibold text-lg text-gray-800">{{ rec.stock_symbol }}</h3>
                                <p class="text-gray-600 text-sm">{{ rec.company_name }}</p>
                            </div>

                            {% if rec.recommendation == 'buy' %}
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1">
                                <i class="fas fa-arrow-up"></i>
                                <span>{{ rec.recommendation|title }}</span>
                            </span>
                            {% elif rec.recommendation == 'sell' %}
                            <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1">
                                <i class="fas fa-arrow-down"></i>
                                <span>{{ rec.recommendation|title }}</span>
                            </span>
                            {% else %}
                            <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1">
                                <i class="fas fa-pause"></i>
                                <span>{{ rec.recommendation|title }}</span>
                            </span>
                            {% endif %}
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-sm mb-3">
                            <div>
                                <span class="text-gray-500">Current:</span>
                                <span class="font-semibold text-gray-800">${{ rec.current_price }}</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Target:</span>
                                <span class="font-semibold text-gray-800">${{ rec.target_price }}</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <span class="text-xs font-medium px-2 py-1 rounded 
                                {% if rec.risk_level == 'low' %}bg-green-100 text-green-800
                                {% elif rec.risk_level == 'medium' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-red-100 text-red-800{% endif %}">
                                {{ rec.risk_level|title }} Risk
                            </span>
                        </div>
                        
                        <p class="text-gray-600 text-sm">{{ rec.analysis|truncatewords:25 }}</p>
                        
                        <div class="mt-3 pt-3 border-t border-gray-100">
                            <p class="text-xs text-gray-500">
                                Published {{ rec.published_date|timesince }} ago
                            </p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-xl text-gray-400"></i>
                    </div>
                    <p class="text-gray-500">
                        {% if user.subscription_tier != 'premium' %}
                        Upgrade to Premium to access stock recommendations.
                        {% else %}
                        No recommendations available at the moment.
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </section>
        </div>

        <!-- Sidebar -->
        <div class="space-y-8">
            <!-- Learning Stats -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center space-x-2">
                    <i class="fas fa-chart-bar text-blue-500"></i>
                    <span>Learning Stats</span>
                </h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-book-open text-blue-600"></i>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">Courses Enrolled</div>
                                <div class="font-semibold text-gray-800">{{ in_progress_courses|length|add:completed_courses|length }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">Courses Completed</div>
                                <div class="font-semibold text-gray-800">{{ completed_courses|length }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-coins text-purple-600"></i>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">Available Credits</div>
                                <div class="font-semibold text-green-600">${{ user.referral_credits }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-crown text-yellow-600"></i>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">Subscription Plan</div>
                                <div class="font-semibold {% if user.subscription_tier == 'premium' %}text-yellow-600{% else %}text-gray-600{% endif %}">
                                    {{ user.subscription_tier|title }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Latest News -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center space-x-2">
                    <i class="fas fa-newspaper text-red-500"></i>
                    <span>Latest News</span>
                </h3>
                
                {% if news_articles %}
                <div class="space-y-4">
                    {% for article in news_articles %}
                    <div class="border-l-4 border-red-500 pl-4 py-1 hover:border-red-600 transition-colors">
                        <h4 class="font-semibold text-sm text-gray-800 line-clamp-2">{{ article.title }}</h4>
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-xs text-gray-500">{{ article.source }}</span>
                            <span class="text-xs text-gray-400">â€¢</span>
                            <span class="text-xs text-gray-500">{{ article.published_date|timesince }} ago</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-newspaper text-3xl text-gray-300 mb-2"></i>
                    <p class="text-gray-500 text-sm">No recent news</p>
                </div>
                {% endif %}
                
                <div class="text-center mt-4 pt-4 border-t border-gray-100">
                    <a href="{% url 'core:news' %}" class="text-blue-600 hover:text-blue-700 text-sm font-semibold flex items-center justify-center space-x-1">
                        <span>Read More News</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>
            </div>

            <!-- Referral Program -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl text-white p-6 relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="font-semibold text-lg mb-2 flex items-center space-x-2">
                        <i class="fas fa-gift"></i>
                        <span>Refer & Earn</span>
                    </h3>
                    <p class="text-green-100 text-sm mb-4">
                        {% if user_referrals|length > 0 %}
                        ðŸŽ‰ You've referred {{ user_referrals|length }} friend{{ user_referrals|length|pluralize }} and earned ${{ user.referral_credits }} in credits!
                        {% else %}
                        Invite friends and earn $50 credits for each successful referral! Share your unique link below.
                        {% endif %}
                    </p>
                    <div class="space-y-3">
                        <a href="{% url 'core:referral' %}" 
                           class="w-full bg-white text-green-600 px-4 py-3 rounded-lg font-semibold text-sm hover:bg-gray-100 transition duration-200 inline-flex items-center justify-center space-x-2">
                            <i class="fas fa-share-alt"></i>
                            <span>Invite Friends & Earn</span>
                        </a>
                        {% if user_referrals|length > 0 %}
                        <div class="text-center">
                            <p class="text-green-100 text-xs">Keep sharing to earn more credits!</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Background decoration -->
                <div class="absolute top-0 right-0 w-20 h-20 bg-white bg-opacity-10 rounded-full -translate-y-8 translate-x-8"></div>
                <div class="absolute bottom-0 left-0 w-12 h-12 bg-white bg-opacity-10 rounded-full translate-y-4 -translate-x-4"></div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-semibold text-lg text-gray-800 mb-4">Quick Actions</h3>
                <div class="grid grid-cols-2 gap-3">
                    <a href="{% url 'core:course_list' %}" 
                       class="bg-blue-50 text-blue-600 p-3 rounded-lg text-center hover:bg-blue-100 transition duration-200">
                        <i class="fas fa-search text-lg mb-1 block"></i>
                        <span class="text-xs font-medium">Browse Courses</span>
                    </a>
                    <a href="{% url 'core:profile' %}" 
                       class="bg-green-50 text-green-600 p-3 rounded-lg text-center hover:bg-green-100 transition duration-200">
                        <i class="fas fa-user text-lg mb-1 block"></i>
                        <span class="text-xs font-medium">My Profile</span>
                    </a>
                    <a href="{% url 'core:stock_recommendations' %}" 
                       class="bg-purple-50 text-purple-600 p-3 rounded-lg text-center hover:bg-purple-100 transition duration-200">
                        <i class="fas fa-chart-line text-lg mb-1 block"></i>
                        <span class="text-xs font-medium">Stocks</span>
                    </a>
                    <a href="{% url 'core:referral' %}" 
                       class="bg-yellow-50 text-yellow-600 p-3 rounded-lg text-center hover:bg-yellow-100 transition duration-200">
                        <i class="fas fa-gift text-lg mb-1 block"></i>
                        <span class="text-xs font-medium">Earn Credits</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add subtle animations to stats cards
    const statsCards = document.querySelectorAll('.bg-white.rounded-xl');
    statsCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Add hover effects to course cards
    const courseCards = document.querySelectorAll('.border-gray-200.rounded-lg');
    courseCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.backdrop-blur-sm {
    backdrop-filter: blur(4px);
}
</style>
{% endblock %}